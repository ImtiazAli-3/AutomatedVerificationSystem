<%- include('header') %>
<div id="page-container">
<main id="content-wrap">
  <!-- page that contains all the failed listings. the listings are shown against the 
  scraped data for comparison if any. from then on the admin can decide if they wish to reject
or accept it. the tables are appended -->
    <table>
        <thead>
          <tr>
            <th>ID</th>
            <th colspan="2">Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Size</th>
            <th>Manufacturer</th>
            <th>Material</th>
            <th>Image</th>
            <th colspan="2">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% failedListings.forEach(listing => { %>
          <tr>
            <td rowspan="2"><%= listing.id %></td>
            <td>Form</td>
            <td><%= listing.fl_name %></td>
            <td class="scrollable-cell"><%= listing.fl_description %></td>
            <td><%= listing.fl_price %></td>
            <td><%= listing.fl_size %></td>
            <td><%= listing.fl_manufacturer %></td>
            <td><%= listing.fl_material %></td>
            <td><img src="/uploads/<%= listing.fl_image %>" alt="Normal Image" height="50" /></td>
            <td rowspan="2">
              <button onclick="verifyListing(<%= listing.id %>)">Verify</button>
            </td>
            <td rowspan="2">
              <button onclick="rejectListing(<%= listing.id %>)">Reject</button>
            </td>
          </tr>
          <tr>
            <td>Scraped</td>
            <td><%= listing.sd_name %></td>
            <td class="scrollable-cell"><%= listing.sd_description %></td>
            <td><%= listing.sd_price %></td>
            <td><%= listing.sd_size %></td>
            <td><%= listing.sd_manufacturer %></td>
            <td><%= listing.sd_material %></td>
            <td><img src="<%= listing.sd_image %>" alt="Scraped Image" height="50" /></td>
          </tr>
          <% }); %>
        </tbody>
      </table>
      

    <script>
        function verifyListing(id) {
            // Implement the fetch API to send a verify request
            fetch(`/dashboardlistings/verify-listing/${id}`, { method: 'POST' })
            .then(response => location.reload())
            .catch(error => console.error('Error verifying listing:', error));
        }

        function rejectListing(id) {
            // Implement the fetch API to send a reject request
            fetch(`/dashboardlistings/reject-listing/${id}`, { method: 'POST' })
            .then(response => location.reload())
            .catch(error => console.error('Error rejecting listing:', error));
        }
    </script>
</main>
<%- include('footer') %>
</div>
<!-- css generated by chat gpt with prompt 'enhance the layout and make this readable' -->
<style>
.scrollable-cell {
    max-height: 100px;
    overflow-y: auto;
  }
  .thumbnail {
    width: auto;
    height: 50px;
  }
  @media (max-width: 600px) {
    table {
      display: block;
    }
    thead {
      display: none;
    }
    tr {
      margin-bottom: 10px;
      display: block;
      border-bottom: 2px solid #ddd;
    }
    td {
      display: block;
      text-align: right;
      padding-left: 50%;
      position: relative;
    }
    td:before {
      content: attr(data-label);
      position: absolute;
      left: 10px;
      text-align: left;
    }
  }
  table {
      width: 99%;
      border-collapse: collapse;
      margin: 5px;
    }
    table, th, td {
      border: 1px solid #ddd;
      text-align: left;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #e8e8e8;
    }
    .description {
      max-width: 300px; /* Adjust as needed */
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>