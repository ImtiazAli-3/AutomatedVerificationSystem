<link rel="stylesheet" href="/styles.css"> 

<%- include('header') %>
<!-- admin dashboard. contains all of the items verified and submitted by users.
has search functionality that uses the id, name, and manufacturer to refine the results.
admins can edit view or delete any items-->
<div id="page-container">
  <main id="content-wrap">
    <form id="searchForm">
      <input type="text" placeholder="Search Items..." name="q" id="searchInput">
      <button type="submit">Search</button>
    </form>
    <div id="searchResults">
      <table>
          <thead>
              <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th>Price</th>
                  <th>Size</th>
                  <th>Material</th>
                  <th>Manufacturer</th>
                  <th>Actions</th>
              </tr>
          </thead>
          <tbody id="searchResultsBody">
            <% if (typeof items !== 'undefined' && items.length > 0) { %>
              <% items.forEach(function(item) { %>
                <tr>
                  <td><%= item.id %></td>
                  <td><%= item.name %></td>
                  <td class="description-cell"><%= item.description %></td>
                  <td><%= item.category %></td>
                  <td>£<%= parseFloat(item.price) %></td>
                  <td><%= item.size %></td>
                  <td><%= item.material %></td>
                  <td><%= item.manufacturer %></td>
                  <td>
                    <a href="/item/<%= item.id %>">View</a>
                    <a href="/admin/items/delete/<%= item.id %>" onclick="return confirm('Are you sure you want to delete this item?');">Delete</a>
                    <a href="/admin/items/edit/<%= item.id %>">Edit</a>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="9">No items found.</td></tr>
            <% } %>
          </tbody>
      </table>
      </div>
  </main>
<%- include('footer') %>
</div>
<script>
// Handle form submission AJAX
document.getElementById('searchForm').addEventListener('submit', async (event) => {
  event.preventDefault(); 
  const searchTerm = document.getElementById('searchInput').value.trim(); // Get the search term
  if (!searchTerm) {
    alert('Please enter a search term');
    return;
  }

  try {
    const response = await fetch(`/dashboard/search?q=${encodeURIComponent(searchTerm)}`);
    if (!response.ok) {
      throw new Error('Failed to fetch results');
    }
    const items = await response.json();

    const searchResultsBody = document.getElementById('searchResultsBody');
    searchResultsBody.innerHTML = ''; // Clear existing results

    items.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.id}</td>
        <td>${item.name}</td>
        <td>${item.description}</td>
        <td>${item.category}</td>
        <td>£${parseFloat(item.price)}</td>
        <td>${item.size}</td>
        <td>${item.material}</td>
        <td>${item.manufacturer}</td>
        <td>
          <a href="/item/${item.id}">View</a>
          <a href="/admin/items/delete/${item.id}" onclick="return confirm('Are you sure you want to delete this item?');">Delete</a>
          <a href="/admin/items/edit/${item.id}">Edit</a>
        </td>
      `;
      searchResultsBody.appendChild(row); // Add new rows
    });
  } catch (error) {
    console.error('Error during search:', error);
    alert('Error fetching search results');
  }
});
</script>
<!-- css generated by chat gpt with prompt 'enhance the layout and make this readable' -->
<style>
  table {
    width: 99%;
    border-collapse: collapse;
    margin:10px;
  }
  table, th, td {
    border: 1px solid #ddd;
    text-align: left;
    padding: 8px;
  }
  th {
    background-color: #f2f2f2;
  }
  tr:nth-child(even) {
    background-color: #f9f9f9;
  }
  tr:hover {
    background-color: #e8e8e8;
  }
  .description {
    max-width: 300px; /* Adjust as needed */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .description-cell {
    max-height: 80px; /* Fixed height for the cell */
    overflow-y: auto; /* Vertical scrolling */
    overflow-x: hidden; /* Hide horizontal scroll */
  }

  #searchForm {
  display: flex;
  justify-content: center; /* Centers the form in the middle of the page */
  padding: 20px;
  gap: 10px; /* Space between input and button */
}

#searchInput {
  width: 100%;
  max-width: 300px; /* Maximum width of the search input */
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

#searchForm button {
  padding: 10px 15px;
  background-color: #007bff; /* Button background color */
  color: white; /* Button text color */
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s;
}

#searchForm button:hover {
  background-color: #0056b3;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 768px) {
  #searchForm {
    flex-direction: column; /* Stack input and button vertically on small screens */
  }

  #searchInput,
  #searchForm button {
    width: calc(100% - 40px); /* Full width minus padding */
  }
}
</style>
